<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>NewsApp - Arjun Karnani</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" type="text/css" href="newsApp.css" />
  </head>
  <body>
    <nav class="navbar">
      <div class="container">
        <img class="logo" src="logo-newsApp.jpg" alt="Logo" />
        <a class="navbar-title" href="http://127.0.0.1:5500/index.html#"
          >NewsApp</a
        >
        <button class="navbar-toggler" id="navbar-toggler">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="navbar-collapse" id="navbarSupportedContent">
          <a class="navbar-home-link" aria-current="page" href="#">Home</a>

          <a class="navbar-sports-link" href="#">Sports</a>

          <a class="navbar-weather-link" href="#">Weather</a>

          <a class="navbar-politics-link" href="#">Politics</a>

          <form class="search-form" role="search">
            <input
              id="searchInput"
              class="form-control"
              type="search"
              placeholder="Enter your Search"
              aria-label="Search"
            />
            <button
              id="search"
              class="btn btn-outline-success"
              style="font-family: 'palatino, serif'"
              type="submit"
            >
              Search
            </button>
          </form>
        </div>
      </div>
    </nav>

    <h1 class="header">
      Welcome to your News App (Page: <span id="pageNumber"></span>, <span id="resultCount"></span> Results)
    </h1>

    <div class="cardsContainer">
      <div class="row content"></div>
      <button class="prev-button" id="previous">&lt; Previous Page</button>
      <button class="next-button" id="next">Next Page &gt;</button>
    </div>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>
    <script>
      let currentQuery = "sports";
      let currentPage = 1;

      const fetchNews = async (page, q) => {
        var url =
          "https://newsapi.org/v2/everything?" +
          "q=" +
          q +
          "&from=2024-01-06&" +
          "language=en&" +
          "pageSize=12&" +
          "page=" +
          page +
          "&sortBy=popularity&" +
          "apiKey=a1fb67c4f1904fc2b611c664083ebfc1";

        var req = new Request(url);

        let a = await fetch(req);
        let response = await a.json();

        let str = "";
        resultCount.innerHTML = response.totalResults;
        pageNumber.innerHTML = currentPage;

        for (let item of response.articles) {
          str =
            str +
            `<div class="cards">
          <img src="${item.urlToImage}" class="cardImage"...">
            <h5 class="cardTextTitle">${item.title.slice(0, 55)}...</h5>
            <p class="cardDescription">${item.description.slice(0, 60)}...</p>
            <a href="${
              item.url
            }" target="_blank" class="cardButton">Read More</a>
            </div>`;
        }

        document.querySelector(".content").innerHTML = str;
      };

      const updateQueryAndFetch = (query) => {
        currentQuery = query;
        currentPage = 1;
        fetchNews(currentPage, query);
      };

      // const updateHeader = () => {
      //   document.querySelector(".header").innerHTML =
      //     "Welcome to your News App (" +
      //     currentPage +
      //     ' / <span id="resultCount"></span> Results)';
      // };

      fetchNews(currentPage, currentQuery); // Inital Call to fetchNews

      document
        .querySelector(".navbar-home-link")
        .addEventListener("click", (e) => {
          e.preventDefault();
          updateQueryAndFetch("general");
        });
      document
        .querySelector(".navbar-sports-link")
        .addEventListener("click", (e) => {
          e.preventDefault();
          updateQueryAndFetch("sports");
        });
      document
        .querySelector(".navbar-weather-link")
        .addEventListener("click", (e) => {
          e.preventDefault();
          updateQueryAndFetch("weather");
        });
      document
        .querySelector(".navbar-politics-link")
        .addEventListener("click", (e) => {
          e.preventDefault();
          updateQueryAndFetch("politics");
        });

      search.addEventListener("click", (e) => {
        e.preventDefault();
        let query = searchInput.value;
        currentQuery = query;
        currentPage = 1;
        fetchNews(currentPage, query);
      });
      previous.addEventListener("click", (e) => {
        e.preventDefault();
        if (currentPage > 1) {
          currentPage = currentPage - 1;
          fetchNews(currentPage, currentQuery);
        }
      });
      next.addEventListener("click", async (e) => {
    e.preventDefault();

    // Fetch the total number of results
    const totalResults = await fetchTotalResults(currentQuery);

    // Calculate the total number of pages based on the total results (assuming 12 results per page)
    const totalPages = Math.ceil(totalResults / 12);

    // Check if incrementing currentPage by 1 will not exceed the total number of pages
    if (currentPage < totalPages) {
        currentPage = currentPage + 1;
        fetchNews(currentPage, currentQuery);
    }
});

// Add a function to fetch the total number of results
async function fetchTotalResults(query) {
    const url = `https://newsapi.org/v2/everything?q=${query}&from=2024-01-06&language=en&apiKey=a1fb67c4f1904fc2b611c664083ebfc1`;
    const response = await fetch(url);
    const data = await response.json();
    return data.totalResults;
}
    </script>
  </body>
</html>
